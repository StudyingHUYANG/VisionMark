# VisionMark 端口配置说明

## 📝 开发者只需修改 1 处！

### 步骤 1：修改后端端口
打开 `server/config.js`，修改第 5 行：

```javascript
PORT: 3000,  // 改成你想要的端口，比如 3000
```

### 步骤 2：同步前端端口
打开 `extension/content/config.local.js`，修改第 8 行，**与后端端口保持一致**：

```javascript
API_BASE: 'http://localhost:3000',  // 改成与后端一致的端口
```

### 步骤 3：重启生效

**后端：**
```bash
cd server
node server.js
```

**前端（插件）：**
1. 打开 `chrome://extensions/`
2. 找到 "B站广告跳过 - 众测版"
3. 点击"刷新"按钮 🔄
4. 刷新 B 站视频页面

---

## 🌍 生产环境部署

### 前端配置
```javascript
// extension/content/config.local.js
API_BASE: 'https://apitest.visionmark.com.cn:8443'
```

### manifest.json 权限
打开 `extension/manifest.json`，修改 host_permissions：

```json
"host_permissions": [
  "https://www.bilibili.com/*",
  "https://apitest.visionmark.com.cn:8443/*"
]
```

---

## 🔍 验证配置是否生效

打开 B 站视频页面，按 `F12` → Console，输入：

```javascript
console.log(window.API_BASE)
```

应该显示你配置的地址，比如：`http://localhost:3000/api/v1`

如果显示的是旧地址，说明插件缓存没清除：
1. 删除插件
2. 重新加载 `extension` 文件夹

---

## 📋 配置文件结构

```
VisionMark/
├── server/
│   ├── config.js          ← 修改这里（后端端口）
│   └── server.js         ← 自动读取 config.js
└── extension/
    └── content/
        └── config.local.js   ← 修改这里（前端端口，需与后端一致）
```

**关键：两个文件的端口必须一致！**

---

## ❓ 常见问题

### Q: 修改了端口但前端还是访问旧端口？
A: 浏览器缓存了旧版本。解决方法：
1. 删除插件，重新加载
2. 或者硬刷新（Ctrl+Shift+R）

### Q: 能不能让前后端自动同步端口？
A: 理论上可以，但需要：
- 后端启动时自动生成前端配置文件
- 或使用环境变量

**当前方案更灵活**：不同开发者可以用不同端口，不会互相冲突。

### Q: 为什么不把 config.local.js 也加入 .gitignore？
A: 已经加入了！每个开发者有自己的端口配置。